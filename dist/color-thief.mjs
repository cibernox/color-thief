if(!t)var t={map:function(t,r){var o={};return r?t.map(function(t,n){return o.index=n,r.call(o,t)}):t.slice()},naturalOrder:function(t,r){return t<r?-1:t>r?1:0},sum:function(t,r){var o={};return t.reduce(r?function(t,n,e){return o.index=e,t+r.call(o,n)}:function(t,r){return t+r},0)},max:function(r,o){return Math.max.apply(null,o?t.map(r,o):r)}};var r=function(){var r=5,o=8-r,n=1e3;function e(t,o,n){return(t<<2*r)+(o<<r)+n}function a(t){var r=[],o=!1;function n(){r.sort(t),o=!0}return{push:function(t){r.push(t),o=!1},peek:function(t){return o||n(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return o||n(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return o||n(),r}}}function u(t,r,o,n,e,a,u){var i=this;i.r1=t,i.r2=r,i.g1=o,i.g2=n,i.b1=e,i.b2=a,i.histo=u}function i(){this.vboxes=new a(function(r,o){return t.naturalOrder(r.vbox.count()*r.vbox.volume(),o.vbox.count()*o.vbox.volume())})}function c(r,o){if(o.count()){var n=o.r2-o.r1+1,a=o.g2-o.g1+1,u=t.max([n,a,o.b2-o.b1+1]);if(1==o.count())return[o.copy()];var i,c,f,s,l=0,h=[],v=[];if(u==n)for(i=o.r1;i<=o.r2;i++){for(s=0,c=o.g1;c<=o.g2;c++)for(f=o.b1;f<=o.b2;f++)s+=r[e(i,c,f)]||0;h[i]=l+=s}else if(u==a)for(i=o.g1;i<=o.g2;i++){for(s=0,c=o.r1;c<=o.r2;c++)for(f=o.b1;f<=o.b2;f++)s+=r[e(c,i,f)]||0;h[i]=l+=s}else for(i=o.b1;i<=o.b2;i++){for(s=0,c=o.r1;c<=o.r2;c++)for(f=o.g1;f<=o.g2;f++)s+=r[e(c,f,i)]||0;h[i]=l+=s}return h.forEach(function(t,r){v[r]=l-t}),function(t){var r,n,e,a,u,c=t+"1",f=t+"2",s=0;for(i=o[c];i<=o[f];i++)if(h[i]>l/2){for(e=o.copy(),a=o.copy(),u=(r=i-o[c])<=(n=o[f]-i)?Math.min(o[f]-1,~~(i+n/2)):Math.max(o[c],~~(i-1-r/2));!h[u];)u++;for(s=v[u];!s&&h[u-1];)s=v[--u];return e[f]=u,a[c]=e[f]+1,[e,a]}}(u==n?"r":u==a?"g":"b")}}return u.prototype={volume:function(t){var r=this;return r._volume&&!t||(r._volume=(r.r2-r.r1+1)*(r.g2-r.g1+1)*(r.b2-r.b1+1)),r._volume},count:function(t){var r=this,o=r.histo;if(!r._count_set||t){var n,a,u,i=0;for(n=r.r1;n<=r.r2;n++)for(a=r.g1;a<=r.g2;a++)for(u=r.b1;u<=r.b2;u++)i+=o[e(n,a,u)]||0;r._count=i,r._count_set=!0}return r._count},copy:function(){var t=this;return new u(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(t){var o=this,n=o.histo;if(!o._avg||t){var a,u,i,c,f=0,s=1<<8-r,l=0,h=0,v=0;for(u=o.r1;u<=o.r2;u++)for(i=o.g1;i<=o.g2;i++)for(c=o.b1;c<=o.b2;c++)f+=a=n[e(u,i,c)]||0,l+=a*(u+.5)*s,h+=a*(i+.5)*s,v+=a*(c+.5)*s;o._avg=f?[~~(l/f),~~(h/f),~~(v/f)]:[~~(s*(o.r1+o.r2+1)/2),~~(s*(o.g1+o.g2+1)/2),~~(s*(o.b1+o.b2+1)/2)]}return o._avg},contains:function(t){var r=this,n=t[0]>>o;return gval=t[1]>>o,bval=t[2]>>o,n>=r.r1&&n<=r.r2&&gval>=r.g1&&gval<=r.g2&&bval>=r.b1&&bval<=r.b2}},i.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,o=0;o<r.size();o++)if(r.peek(o).vbox.contains(t))return r.peek(o).color;return this.nearest(t)},nearest:function(t){for(var r,o,n,e=this.vboxes,a=0;a<e.size();a++)((o=Math.sqrt(Math.pow(t[0]-e.peek(a).color[0],2)+Math.pow(t[1]-e.peek(a).color[1],2)+Math.pow(t[2]-e.peek(a).color[2],2)))<r||void 0===r)&&(r=o,n=e.peek(a).color);return n},forcebw:function(){var r=this.vboxes;r.sort(function(r,o){return t.naturalOrder(t.sum(r.color),t.sum(o.color))});var o=r[0].color;o[0]<5&&o[1]<5&&o[2]<5&&(r[0].color=[0,0,0]);var n=r.length-1,e=r[n].color;e[0]>251&&e[1]>251&&e[2]>251&&(r[n].color=[255,255,255])}},{quantize:function(f,s){if(!f.length||s<2||s>256)return!1;var l=function(t){var n,a=new Array(1<<3*r);return t.forEach(function(t){n=e(t[0]>>o,t[1]>>o,t[2]>>o),a[n]=(a[n]||0)+1}),a}(f);l.forEach(function(){});var h=function(t,r){var n,e,a,i=1e6,c=0,f=1e6,s=0,l=1e6,h=0;return t.forEach(function(t){(n=t[0]>>o)<i?i=n:n>c&&(c=n),(e=t[1]>>o)<f?f=e:e>s&&(s=e),(a=t[2]>>o)<l?l=a:a>h&&(h=a)}),new u(i,c,f,s,l,h,r)}(f,l),v=new a(function(r,o){return t.naturalOrder(r.count(),o.count())});function g(t,r){for(var o,e=t.size(),a=0;a<n;){if(e>=r)return;if(a++>n)return;if((o=t.pop()).count()){var u=c(l,o),i=u[0],f=u[1];if(!i)return;t.push(i),f&&(t.push(f),e++)}else t.push(o),a++}}v.push(h),g(v,.75*s);for(var p=new a(function(r,o){return t.naturalOrder(r.count()*r.volume(),o.count()*o.volume())});v.size();)p.push(v.pop());g(p,s);for(var d=new i;p.size();)d.push(p.pop());return d}}}().quantize,o=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=t.naturalWidth,this.height=this.canvas.height=t.naturalHeight,this.context.drawImage(t,0,0,this.width,this.height)};o.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var n=function(){};n.prototype.getColor=function(t,r){var o=void 0===r?{}:r,n=o.quality,e=o.areaToExclude;return this.getPalette(t,5,{quality:void 0===n?10:n,areaToExclude:void 0===e?void 0:e})[0]},n.prototype.getPalette=function(t,n,e){var a=void 0===e?{}:e,u=function(t){var r=t.colorCount,o=t.quality,n=t.areaToExclude;if(void 0!==r&&Number.isInteger(r)){if(1===r)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");r=Math.max(r,2),r=Math.min(r,20)}else r=10;if((void 0===o||!Number.isInteger(o)||o<1)&&(o=10),n){if(!Array.isArray(n)||2!==n.length)throw new Error("areaToExclude should be an array of 2 coordinates");if(n.some(function(t){return!Array.isArray(t)||2!==t.length}))throw new Error("areaToExclude must contain an array top-left and bottom-right coordinates")}return{colorCount:r,quality:o,areaToExclude:n}}({colorCount:n,quality:a.quality,areaToExclude:a.areaToExclude}),i=new o(t),c=function(t,r,o,n,e){var a=r*o,u=t,i=[],c=0,f=0,s=0,l=0;if(e){var h=e[0],v=e[1];c=h[0],s=h[1],f=v[0],l=v[1]}for(var g,p,d,b,m,x=0;x<a;x+=n){var y=x%r,w=Math.floor(x/r);y>=c&&y<=f&&w>=s&&w<=l||(p=u[0+(g=4*x)],d=u[g+1],b=u[g+2],(void 0===(m=u[g+3])||m>=125)&&(p>250&&d>250&&b>250||i.push([p,d,b])))}return console.log("pixelArray.length",i.length),i}(i.getImageData().data,i.width,i.height,u.quality,u.areaToExclude),f=r(c,u.colorCount);return f?f.palette():null},n.prototype.getColorFromUrl=function(t,r,o){var n=this,e=document.createElement("img");e.addEventListener("load",function(){var a=n.getPalette(e,5,o);r(a[0],t)}),e.src=t},n.prototype.getImageData=function(t,r){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){if(200==this.status){var t=new Uint8Array(this.response);i=t.length;for(var o=new Array(i),n=0;n<t.length;n++)o[n]=String.fromCharCode(t[n]);var e=o.join(""),a=window.btoa(e);r("data:image/png;base64,"+a)}},o.send()},n.prototype.getColorAsync=function(t,r,o){var n=this;this.getImageData(t,function(t){var e=document.createElement("img");e.addEventListener("load",function(){var t=n.getPalette(e,5,o);r(t[0],this)}),e.src=t})};export{n as default};
